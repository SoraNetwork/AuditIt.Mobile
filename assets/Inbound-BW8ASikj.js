import{d as oe,r,C as le,o as ie,b as I,f as a,p as k,q as F,i as se,g as s,h as n,H as g,n as v,G as Q,m as re,F as ue,E as de,k as u,l as h}from"./index-D-N10Xfp.js";import{u as me}from"./itemDefinitionStore-MEi61h0W.js";import{u as ce}from"./warehouseStore-Bua0j24B.js";import pe from"./ItemDefinitionForm-DFnRrNcR.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./categoryStore-BO4ZJwnt.js";const ve={class:"page-container"},_e=["onClick"],ke={key:0,style:{color:"#888"}},ye=oe({__name:"Inbound",setup(we){const d=r([]),f=r(!1),D=r(!1),y=r(""),$=r(null),V=async()=>{f.value=!0;try{const o=await g.get("/QuickRemarks");d.value=o.data||[]}catch(o){console.error("fetchQuickRemarks",o)}finally{f.value=!1}},L=o=>{if(!o)return;const e=d.value.find(i=>i.id===o);e&&(l.remarks=e.text)},B=async()=>{const o=y.value?.trim();if(!o){u.warning("请输入备注内容");return}f.value=!0;try{const e=await g.post("/QuickRemarks",{content:o});d.value.unshift(e.data),y.value="",u.success("添加成功")}catch(e){console.error("createQuickRemark",e),u.error("添加失败")}finally{f.value=!1}},P=async o=>{f.value=!0;try{await g.delete(`/QuickRemarks/${o}`),d.value=d.value.filter(e=>e.id!==o),u.success("已删除")}catch(e){console.error("deleteQuickRemark",e),u.error("删除失败")}finally{f.value=!1}},K=se(),R=me(),x=ce(),w=r("form"),C=r(!1),q=r(),l=le({itemDefinitionId:null,warehouseId:null,quantity:1,remarks:""}),m=r([]),M={itemDefinitionId:[{required:!0,message:"请选择物品定义"}],warehouseId:[{required:!0,message:"请选择仓库"}],quantity:[{required:!0,message:"请输入数量",type:"number",min:1}]},b=r(!1),z=r(null);ie(()=>{R.fetchItemDefinitions(),x.fetchWarehouses(),V()});const A=()=>{q.value?.resetFields(),l.remarks=""},E=async()=>{try{await q.value?.validate();const o=R.itemDefinitions.find(i=>i.id===l.itemDefinitionId),e=x.warehouses.find(i=>i.id===l.warehouseId);for(let i=0;i<l.quantity;i++)m.value.push({tempId:Date.now()+i,itemDefinitionId:l.itemDefinitionId,warehouseId:l.warehouseId,remarks:l.remarks,definitionName:o?.name,warehouseName:e?.name});u.success(`${l.quantity}个物品已添加到待打印列表`),A(),w.value="list"}catch{u.error("请填写所有必填项。")}},W=o=>{m.value.splice(o,1)},j=async()=>{C.value=!0;const o=[];try{for(const i of m.value){const c=new FormData;c.append("itemDefinitionId",i.itemDefinitionId),c.append("warehouseId",i.warehouseId),i.remarks&&c.append("remarks",i.remarks);const p=await g.post("/items/create",c,{headers:{"Content-Type":"multipart/form-data"}});o.push(p.data)}u.success(`${m.value.length}个新物品已成功保存!`);const e=o.map(i=>i.id);console.log("IDs to print (mobile):",e),u.info("请在电脑端进行打印操作。"),m.value=[],w.value="form"}catch(e){u.error("保存过程中发生错误。"),console.error(e)}finally{C.value=!1}},G=o=>{b.value=!1,l.itemDefinitionId=o.id};return(o,e)=>{const i=s("a-page-header"),c=s("a-select"),p=s("a-button"),N=s("a-space-compact"),_=s("a-form-item"),H=s("a-input-number"),J=s("a-textarea"),O=s("a-form"),S=s("a-tab-pane"),X=s("a-list-item-meta"),Y=s("a-list-item"),Z=s("a-list"),ee=s("a-tabs"),U=s("a-drawer"),te=s("a-input"),ae=s("a-space"),ne=s("a-divider");return h(),I("div",null,[a(i,{title:"手动入庫","sub-title":"生成新物品和条码",onBack:e[0]||(e[0]=t=>F(K).back())}),k("div",ve,[a(ee,{activeKey:w.value,"onUpdate:activeKey":e[8]||(e[8]=t=>w.value=t)},{default:n(()=>[a(S,{key:"form",tab:"录入信息"},{default:n(()=>[a(O,{ref_key:"manualFormRef",ref:q,model:l,rules:M,layout:"vertical"},{default:n(()=>[a(_,{label:"物品定义",name:"itemDefinitionId"},{default:n(()=>[a(N,{style:{width:"100%"}},{default:n(()=>[a(c,{value:l.itemDefinitionId,"onUpdate:value":e[1]||(e[1]=t=>l.itemDefinitionId=t),"show-search":"",placeholder:"搜索或选择物品定义",options:F(R).itemDefinitions.map(t=>({value:t.id,label:t.name})),style:{width:"calc(100% - 60px)"}},null,8,["value","options"]),a(p,{onClick:e[2]||(e[2]=t=>b.value=!0)},{default:n(()=>e[12]||(e[12]=[v("新建",-1)])),_:1,__:[12]})]),_:1})]),_:1}),a(_,{label:"存放仓库",name:"warehouseId"},{default:n(()=>[a(c,{value:l.warehouseId,"onUpdate:value":e[3]||(e[3]=t=>l.warehouseId=t),placeholder:"选择仓库",options:F(x).warehouses.map(t=>({value:t.id,label:t.name}))},null,8,["value","options"])]),_:1}),a(_,{label:"数量",name:"quantity"},{default:n(()=>[a(H,{value:l.quantity,"onUpdate:value":e[4]||(e[4]=t=>l.quantity=t),min:1,style:{width:"100%"}},null,8,["value"])]),_:1}),a(_,{label:"备注"},{default:n(()=>[a(N,{style:{width:"100%"}},{default:n(()=>[a(J,{value:l.remarks,"onUpdate:value":e[5]||(e[5]=t=>l.remarks=t),style:{width:"calc(100% - 180px)"}},null,8,["value"]),a(c,{value:$.value,"onUpdate:value":e[6]||(e[6]=t=>$.value=t),options:d.value.map(t=>({value:t.id,label:t.text})),placeholder:"快捷备注",allowClear:"",onChange:L,style:{width:"120px"}},null,8,["value","options"]),a(p,{onClick:e[7]||(e[7]=t=>D.value=!0)},{default:n(()=>e[13]||(e[13]=[v("管理",-1)])),_:1,__:[13]})]),_:1})]),_:1}),a(_,null,{default:n(()=>[a(p,{type:"primary",onClick:E,block:""},{default:n(()=>e[14]||(e[14]=[v("添加到待打印列表",-1)])),_:1,__:[14]})]),_:1})]),_:1},8,["model"])]),_:1}),a(S,{key:"list",tab:`待打印列表 (${m.value.length})`},{default:n(()=>[a(p,{type:"primary",onClick:j,loading:C.value,disabled:!m.value.length,block:"",size:"large",style:{"margin-bottom":"16px"}},{default:n(()=>e[15]||(e[15]=[v(" 全部保存并打印 ",-1)])),_:1,__:[15]},8,["loading","disabled"]),a(Z,{"item-layout":"horizontal","data-source":m.value},{renderItem:n(({item:t,index:T})=>[a(Y,null,{actions:n(()=>[k("a",{key:"list-loadmore-edit",onClick:be=>W(T),style:{color:"red"}},"移除",8,_e)]),default:n(()=>[a(X,{description:`仓库: ${t.warehouseName}`},{title:n(()=>[v(Q(t.definitionName),1)]),_:2},1032,["description"]),k("div",null,Q(t.remarks),1)]),_:2},1024)]),_:1},8,["data-source"])]),_:1},8,["tab"])]),_:1},8,["activeKey"])]),a(U,{title:"新建物品定义",width:"90%",open:b.value,onClose:e[9]||(e[9]=t=>b.value=!1)},{default:n(()=>[a(pe,{ref_key:"newItemDefFormRef",ref:z,onSubmitted:G},null,512)]),_:1},8,["open"]),a(U,{title:"管理快捷备注",width:"90%",open:D.value,onClose:e[11]||(e[11]=t=>D.value=!1)},{default:n(()=>[k("div",null,[a(ae,{style:{width:"100%","margin-bottom":"12px"}},{default:n(()=>[a(te,{value:y.value,"onUpdate:value":e[10]||(e[10]=t=>y.value=t),placeholder:"请输入新快捷备注"},null,8,["value"]),a(p,{type:"primary",onClick:B,loading:f.value},{default:n(()=>e[16]||(e[16]=[v("添加",-1)])),_:1,__:[16]},8,["loading"])]),_:1}),a(ne),d.value.length?re("",!0):(h(),I("div",ke,"暂无快捷备注")),(h(!0),I(ue,null,de(d.value,t=>(h(),I("div",{key:t.id,style:{display:"flex","justify-content":"space-between","align-items":"center",padding:"6px 0","border-bottom":"1px solid #f0f0f0"}},[k("div",null,Q(t.text),1),a(p,{type:"text",danger:"",onClick:T=>P(t.id)},{default:n(()=>e[17]||(e[17]=[v("删除",-1)])),_:2,__:[17]},1032,["onClick"])]))),128))])]),_:1},8,["open"])])}}}),Ce=fe(ye,[["__scopeId","data-v-55292dcc"]]);export{Ce as default};
