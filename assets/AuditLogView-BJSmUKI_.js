import{e as t,I,d as D,r as x,C as F,B as P,S as z,o as U,A as E,a as h,m as d,p as v,g as T,f as r,w as o,D as G,l as c,k as q,G as f,j as C}from"./index-ZKSOVZXK.js";import{u as J}from"./auditLogStore-BnS0G72f.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";var W={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"};function S(u){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?Object(arguments[s]):{},i=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(l).filter(function(a){return Object.getOwnPropertyDescriptor(l,a).enumerable}))),i.forEach(function(a){X(u,a,l[a])})}return u}function X(u,s,l){return s in u?Object.defineProperty(u,s,{value:l,enumerable:!0,configurable:!0,writable:!0}):u[s]=l,u}var O=function(s,l){var i=S({},s,l.attrs);return t(I,S({},i,{icon:W}),null)};O.displayName="FilterOutlined";O.inheritAttrs=!1;const Y={class:"page-wrapper"},Z={class:"filter-controls"},K={class:"list-item-wrapper"},ee={class:"log-meta"},te={class:"log-meta"},ae={key:0,style:{"text-align":"center","margin-top":"16px"}},oe=D({__name:"AuditLogView",setup(u){const s=T(),l=J(),i=x(!1),a=F({dateRange:null,action:void 0,user:""}),g=x(null),k=x("400px"),R=()=>{if(g.value){const p=g.value.offsetHeight,e=60;k.value=`calc(100vh - ${p}px - ${e}px)`}},L=P(()=>l.logs.filter(p=>{const e=z(p.timestamp),w=!a.dateRange||e.isAfter(a.dateRange[0].startOf("day"))&&e.isBefore(a.dateRange[1].endOf("day")),_=!a.action||p.action===a.action,b=!a.user||p.user.toLowerCase().includes(a.user.toLowerCase());return w&&_&&b}));return U(async()=>{await l.fetchLogs(),await E(),R()}),(p,e)=>{const w=r("a-page-header"),_=r("a-button"),b=r("router-link"),V=r("a-card"),B=r("a-empty"),H=r("a-list"),M=r("a-range-picker"),y=r("a-form-item"),m=r("a-select-option"),N=r("a-select"),$=r("a-input"),j=r("a-form"),A=r("a-drawer");return C(),h("div",Y,[d("div",{class:"fixed-content",ref_key:"fixedContentRef",ref:g},[t(w,{title:"审计日志",onBack:e[0]||(e[0]=n=>v(s).back())}),d("div",Z,[t(_,{block:"",onClick:e[1]||(e[1]=n=>i.value=!0)},{icon:o(()=>[t(v(O))]),default:o(()=>[e[7]||(e[7]=c(" 筛选日志 ",-1))]),_:1,__:[7]})])],512),d("div",{class:"scrollable-content",style:G({height:k.value})},[t(H,{"data-source":L.value,loading:v(l).loading,split:!1},{renderItem:o(({item:n})=>[d("div",K,[t(V,null,{default:o(()=>[d("p",null,[d("strong",null,f(n.action),1),e[8]||(e[8]=c(" - ",-1)),t(b,{to:{name:"item-details",params:{id:n.itemId}}},{default:o(()=>[c(f(n.itemShortId),1)]),_:2},1032,["to"])]),d("p",ee,f(new Date(n.timestamp).toLocaleString()),1),d("p",te,"操作人: "+f(n.user)+" | 仓库: "+f(n.warehouseName),1)]),_:2},1024)])]),loadMore:o(()=>[!v(l).loading&&L.value.length===0?(C(),h("div",ae,[t(B,{description:"没有找到符合条件的日志"})])):q("",!0)]),_:1},8,["data-source","loading"])],4),t(A,{title:"筛选日志",width:"90%",open:i.value,onClose:e[6]||(e[6]=n=>i.value=!1)},{footer:o(()=>[t(_,{onClick:e[5]||(e[5]=n=>i.value=!1)},{default:o(()=>e[13]||(e[13]=[c("关闭",-1)])),_:1,__:[13]})]),default:o(()=>[t(j,{layout:"vertical",model:a},{default:o(()=>[t(y,{label:"日期范围"},{default:o(()=>[t(M,{value:a.dateRange,"onUpdate:value":e[2]||(e[2]=n=>a.dateRange=n),style:{width:"100%"}},null,8,["value"])]),_:1}),t(y,{label:"操作类型"},{default:o(()=>[t(N,{value:a.action,"onUpdate:value":e[3]||(e[3]=n=>a.action=n),placeholder:"所有类型","allow-clear":""},{default:o(()=>[t(m,{value:"入库"},{default:o(()=>e[9]||(e[9]=[c("入库",-1)])),_:1,__:[9]}),t(m,{value:"借出"},{default:o(()=>e[10]||(e[10]=[c("借出",-1)])),_:1,__:[10]}),t(m,{value:"处置"},{default:o(()=>e[11]||(e[11]=[c("处置",-1)])),_:1,__:[11]}),t(m,{value:"归还"},{default:o(()=>e[12]||(e[12]=[c("归还",-1)])),_:1,__:[12]})]),_:1},8,["value"])]),_:1}),t(y,{label:"操作人"},{default:o(()=>[t($,{value:a.user,"onUpdate:value":e[4]||(e[4]=n=>a.user=n),placeholder:"输入用户名","allow-clear":""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])])}}}),se=Q(oe,[["__scopeId","data-v-ca55b2dd"]]);export{se as default};
