import{f as n,I as N,d as $,r as O,C as z,B as H,H as M,o as R,j as q,k as g,i as A,b as U,p as h,q as m,g as s,e as b,h as c,n as I,l as p}from"./index-BrlnX8tt.js";import{u as D}from"./itemStore-b35XOLSy.js";import{_ as T}from"./_plugin-vue_export-helper-DlAUqK2U.js";var G={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};function x(i){for(var o=1;o<arguments.length;o++){var t=arguments[o]!=null?Object(arguments[o]):{},r=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable}))),r.forEach(function(a){J(i,a,t[a])})}return i}function J(i,o,t){return o in i?Object.defineProperty(i,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[o]=t,i}var y=function(o,t){var r=x({},o,t.attrs);return n(N,x({},r,{icon:G}),null)};y.displayName="UploadOutlined";y.inheritAttrs=!1;const Q={class:"page-container"},W={style:{"margin-top":"16px"}},X={key:1,class:"loading-container"},Y=$({__name:"ItemEdit",setup(i){const o=q(),t=A(),r=D(),a=O(null),u=z({remarks:""}),d=O([]),w=H(()=>a.value?.photoUrl?`${(M.defaults.baseURL||"").replace("/api","")}${a.value.photoUrl}`:"");R(async()=>{const l=o.params.id;await r.fetchItems({id:l});const e=r.items.find(f=>f.id===l);e?(a.value=e,u.remarks=e.remarks||""):(g.error("未找到物品"),t.back())});const B=l=>{l.fileList.length>0?(d.value=[l.fileList[l.fileList.length-1]],u.photo=l.file.originFileObj):(d.value=[],delete u.photo)},C=async()=>{if(a.value)try{await r.updateItem(a.value.id,{remarks:u.remarks,photo:u.photo}),g.success("物品信息已更新"),t.back()}catch{g.error("更新失败")}};return(l,e)=>{const f=s("a-page-header"),L=s("a-textarea"),_=s("a-form-item"),k=s("a-button"),S=s("a-upload"),V=s("a-image"),j=s("a-empty"),P=s("a-form"),E=s("a-card"),F=s("a-spin");return p(),U("div",null,[n(f,{title:`编辑: ${a.value?.shortId}`,onBack:e[0]||(e[0]=()=>m(t).back())},null,8,["title"]),h("div",Q,[!m(r).loading&&a.value?(p(),b(E,{key:0},{default:c(()=>[n(P,{model:u,onFinish:C,layout:"vertical"},{default:c(()=>[n(_,{label:"备注"},{default:c(()=>[n(L,{value:u.remarks,"onUpdate:value":e[1]||(e[1]=v=>u.remarks=v),rows:4},null,8,["value"])]),_:1}),n(_,{label:"更换照片"},{default:c(()=>[n(S,{"file-list":d.value,"onUpdate:fileList":e[2]||(e[2]=v=>d.value=v),"before-upload":()=>!1,onChange:B,"list-type":"picture",accept:"image/*"},{default:c(()=>[n(k,null,{default:c(()=>[n(m(y)),e[3]||(e[3]=I(" 选择新照片 ",-1))]),_:1,__:[3]})]),_:1},8,["file-list"]),h("div",W,[e[4]||(e[4]=h("p",null,"当前照片:",-1)),a.value.photoUrl?(p(),b(V,{key:0,width:100,src:w.value},null,8,["src"])):(p(),b(j,{key:1,description:"暂无照片"}))])]),_:1}),n(_,null,{default:c(()=>[n(k,{type:"primary","html-type":"submit",loading:m(r).loading,block:""},{default:c(()=>e[5]||(e[5]=[I(" 保存更改 ",-1)])),_:1,__:[5]},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})):(p(),U("div",X,[n(F,{size:"large"})]))])])}}}),te=T(Y,[["__scopeId","data-v-398d5a6f"]]);export{te as default};
