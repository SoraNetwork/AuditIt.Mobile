import{d as z,r as g,h as A,B as O,o as $,A as j,a as m,m as v,b as k,k as b,p as h,g as E,e as a,w as s,f as o,D as F,l as i,G as l,j as r}from"./index-ZKSOVZXK.js";import{u as G}from"./itemStore-BnTy3yOW.js";import{u as M}from"./auditLogStore-BnS0G72f.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";const q={class:"page-wrapper"},J={key:1,class:"details-section"},K={key:0,class:"loading-container"},Q={class:"list-item-wrapper"},W=z({__name:"ItemDetails",setup(X){const w=A(),S=E(),x=G(),u=M(),d=g(!0),_=w.params.id,p=g(null),y=g("300px"),t=O(()=>x.items.find(e=>e.id===_)),D=()=>{if(p.value){const e=p.value.offsetHeight,n=60;y.value=`calc(100vh - ${e}px - ${n}px)`}};$(async()=>{d.value=!0,u.logs=[];try{const e=t.value?Promise.resolve():x.fetchItems({id:_}),n=u.fetchLogs({itemId:_});await Promise.all([e,n])}catch(e){console.error("Failed to load item details:",e)}finally{d.value=!1,await j(),D()}});const I=e=>{switch(e){case"InStock":return"success";case"LoanedOut":return"warning";case"Disposed":return"error";default:return"default"}},L=e=>{switch(e){case"InStock":return"在库";case"LoanedOut":return"已借出";case"Disposed":return"已处置";default:return"未知"}};return(e,n)=>{const C=o("a-page-header"),c=o("a-descriptions-item"),B=o("a-badge"),H=o("a-descriptions"),N=o("a-spin"),P=o("a-list-item-meta"),R=o("a-card"),V=o("a-list"),T=o("a-empty");return r(),m("div",q,[v("div",{class:"fixed-content",ref_key:"fixedContentRef",ref:p},[t.value?(r(),k(C,{key:0,title:t.value.itemDefinition?.name,onBack:n[0]||(n[0]=()=>h(S).back())},null,8,["title"])):b("",!0),!d.value&&t.value?(r(),m("div",J,[a(H,{bordered:"",column:1},{default:s(()=>[a(c,{label:"短ID"},{default:s(()=>[i(l(t.value.shortId),1)]),_:1}),a(c,{label:"状态"},{default:s(()=>[a(B,{status:I(t.value.status),text:L(t.value.status)},null,8,["status","text"])]),_:1}),a(c,{label:"仓库"},{default:s(()=>[i(l(t.value.warehouse?.name),1)]),_:1}),a(c,{label:"入库日期"},{default:s(()=>[i(l(new Date(t.value.entryDate).toLocaleString()),1)]),_:1}),a(c,{label:"最后更新"},{default:s(()=>[i(l(new Date(t.value.lastUpdated).toLocaleString()),1)]),_:1})]),_:1})])):b("",!0)],512),d.value?(r(),m("div",K,[a(N,{size:"large"})])):t.value?(r(),m("div",{key:1,class:"scrollable-content",style:F({height:y.value})},[n[1]||(n[1]=v("h3",{class:"log-title"},"操作历史",-1)),a(V,{loading:h(u).loading,"data-source":h(u).logs,split:!1},{renderItem:s(({item:f})=>[v("div",Q,[a(R,null,{default:s(()=>[a(P,null,{title:s(()=>[i(l(f.action)+" - by "+l(f.user),1)]),description:s(()=>[i(l(new Date(f.timestamp).toLocaleString()),1)]),_:2},1024)]),_:2},1024)])]),_:1},8,["loading","data-source"])],4)):(r(),k(T,{key:2}))])}}}),ae=U(W,[["__scopeId","data-v-390616d9"]]);export{ae as default};
