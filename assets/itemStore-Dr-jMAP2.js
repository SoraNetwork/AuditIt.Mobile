import{O as u,L as r}from"./index-DBu20Y8x.js";const n=[];for(let t=0;t<256;++t)n.push((t+256).toString(16).slice(1));function m(t,e=0){return(n[t[e+0]]+n[t[e+1]]+n[t[e+2]]+n[t[e+3]]+"-"+n[t[e+4]]+n[t[e+5]]+"-"+n[t[e+6]]+n[t[e+7]]+"-"+n[t[e+8]]+n[t[e+9]]+"-"+n[t[e+10]]+n[t[e+11]]+n[t[e+12]]+n[t[e+13]]+n[t[e+14]]+n[t[e+15]]).toLowerCase()}let a;const p=new Uint8Array(16);function h(){if(!a){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");a=crypto.getRandomValues.bind(crypto)}return a(p)}const c=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),d={randomUUID:c};function I(t,e,o){if(d.randomUUID&&!t)return d.randomUUID();t=t||{};const s=t.random??t.rng?.()??h();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,m(s)}const l=t=>t.substring(0,8).toUpperCase(),y=u("item",{state:()=>({items:[],preInboundItems:[],loading:!1,error:null}),actions:{async fetchItems(t={}){this.loading=!0,this.error=null;try{const e=new URLSearchParams;t.warehouseId&&e.append("warehouseId",t.warehouseId.toString()),t.status&&e.append("status",t.status),t.id&&e.append("id",t.id),t.shortId&&e.append("shortId",t.shortId);const o=await r.get(`/items?${e.toString()}`);this.items=o.data}catch(e){this.error="获取库存物品失败: "+(e.response?.data?.message||e.message)}finally{this.loading=!1}},preInbound(t,e){this.preInboundItems=[];for(let o=0;o<e;o++){const s=I();this.preInboundItems.push({id:s,shortId:l(s),itemDefinitionId:t})}},async confirmInbound(t){if(this.preInboundItems.length!==0){this.loading=!0,this.error=null;try{const e=this.preInboundItems.map(i=>r.post("/items/inbound",{itemDefinitionId:i.itemDefinitionId,warehouseId:t})),s=(await Promise.all(e)).map(i=>i.data);this.items.unshift(...s),this.preInboundItems=[]}catch(e){throw this.error="确认入库失败: "+(e.response?.data?.message||e.message),e}finally{this.loading=!1}}},async updateItemStatus(t,e){this.loading=!0,this.error=null;try{const o=await r.put(`/items/${t}/${e}`),s=this.items.findIndex(i=>i.id===t);s!==-1&&(this.items[s]=o.data)}catch(o){throw this.error=`物品操作 '${e}' 失败: `+(o.response?.data?.message||o.message),o}finally{this.loading=!1}}}});export{y as u};
