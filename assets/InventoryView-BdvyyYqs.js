import{d as W,r as d,C as q,o as z,A as G,B as Q,b as v,p as n,f as a,g as s,h as o,D as j,k as J,F as K,E as X,n as l,e as U,m as w,q as Y,i as Z,G as u,l as c}from"./index-DdZCSEGE.js";import{u as ee}from"./itemStore-BnWGHin2.js";import{u as te}from"./warehouseStore-CgWbvVA1.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={InStock:{text:"在库",color:"green"},LoanedOut:{text:"借出",color:"orange"},Disposed:{text:"处置",color:"red"},SuspectedMissing:{text:"疑似丢失",color:"purple"}},se={class:"page-wrapper"},ne={class:"filter-controls"},le={class:"list-item-wrapper"},re={class:"card-title"},ue={key:0},ie={key:1},de={class:"item-id"},ce=W({__name:"InventoryView",setup(pe){const V=Z(),h=ee(),x=te(),p=d(!0),g=d([]),k=d([]),_=d(""),i=q({warehouseId:void 0,status:void 0}),y=d(null),I=d("400px"),B=()=>{if(y.value){const r=y.value.offsetHeight,e=60;I.value=`calc(100vh - ${r}px - ${e}px)`}},C=r=>ae[r]||{text:"未知",color:"gray"},D=async()=>{p.value=!0;try{await Promise.all([h.fetchItems({...i}),x.fetchWarehouses()]),g.value=h.items,k.value=x.warehouses}catch(r){console.error("Failed to fetch inventory data:",r),J.error("加载库存数据失败"),g.value=[]}finally{p.value=!1}};z(async()=>{await D(),await G(),B()});const H=Q(()=>{const r=g.value.map(e=>({...e,name:e.itemDefinition?.name||"未知物品",warehouseName:e.warehouse?.name||"未知仓库"}));if(_.value){const e=_.value.toLowerCase();return r.filter(m=>m.name.toLowerCase().includes(e)||m.shortId.toLowerCase().includes(e))}return r}),S=()=>{D()};return(r,e)=>{const m=s("a-page-header"),f=s("a-select-option"),b=s("a-select"),L=s("a-form-item"),N=s("a-col"),T=s("a-row"),F=s("a-form"),A=s("a-input-search"),M=s("a-tag"),R=s("a-card"),$=s("router-link"),E=s("a-button"),O=s("a-empty"),P=s("a-list");return c(),v("div",se,[n("div",{class:"fixed-content",ref_key:"fixedContentRef",ref:y},[a(m,{title:"库存总览","show-back":!1}),n("div",ne,[a(F,{layout:"vertical",model:i},{default:o(()=>[a(T,{gutter:16},{default:o(()=>[a(N,{span:12},{default:o(()=>[a(L,null,{default:o(()=>[a(b,{value:i.warehouseId,"onUpdate:value":e[0]||(e[0]=t=>i.warehouseId=t),placeholder:"所有仓库","allow-clear":"",onChange:S},{default:o(()=>[(c(!0),v(K,null,X(k.value,t=>(c(),U(f,{key:t.id,value:t.id},{default:o(()=>[l(u(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),a(N,{span:12},{default:o(()=>[a(L,null,{default:o(()=>[a(b,{value:i.status,"onUpdate:value":e[1]||(e[1]=t=>i.status=t),placeholder:"所有状态","allow-clear":"",onChange:S},{default:o(()=>[a(f,{value:"InStock"},{default:o(()=>e[4]||(e[4]=[l("在库",-1)])),_:1,__:[4]}),a(f,{value:"LoanedOut"},{default:o(()=>e[5]||(e[5]=[l("借出",-1)])),_:1,__:[5]}),a(f,{value:"Disposed"},{default:o(()=>e[6]||(e[6]=[l("处置",-1)])),_:1,__:[6]})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),a(A,{value:_.value,"onUpdate:value":e[2]||(e[2]=t=>_.value=t),placeholder:"通过ID或名称搜索..."},null,8,["value"])])],512),n("div",{class:"scrollable-content",style:j({height:I.value})},[a(P,{"data-source":H.value,loading:p.value,split:!1},{renderItem:o(({item:t})=>[n("div",le,[a($,{to:{name:"item-details",params:{id:t.id}}},{default:o(()=>[a(R,{hoverable:""},{title:o(()=>[n("span",re,u(t.name),1)]),extra:o(()=>[a(M,{color:C(t.status).color},{default:o(()=>[l(u(C(t.status).text),1)]),_:2},1032,["color"])]),default:o(()=>[n("p",null,[e[7]||(e[7]=n("strong",null,"可视化ID:",-1)),l(" "+u(t.shortId),1)]),n("p",null,[e[8]||(e[8]=n("strong",null,"所在仓库:",-1)),l(" "+u(t.warehouseName),1)]),t.currentDestination?(c(),v("p",ue,[e[9]||(e[9]=n("strong",null,"当前去向:",-1)),l(" "+u(t.currentDestination),1)])):w("",!0),t.remarks?(c(),v("p",ie,[e[10]||(e[10]=n("strong",null,"备注:",-1)),l(" "+u(t.remarks),1)])):w("",!0),n("p",de,[e[11]||(e[11]=n("strong",null,"UUID:",-1)),l(" "+u(t.id),1)])]),_:2},1024)]),_:2},1032,["to"])])]),empty:o(()=>[p.value?w("",!0):(c(),U(O,{key:0,description:"没有找到物品"},{default:o(()=>[a(E,{type:"primary",onClick:e[3]||(e[3]=t=>Y(V).push("/inbound"))},{default:o(()=>e[12]||(e[12]=[l("立即入库",-1)])),_:1,__:[12]})]),_:1}))]),_:1},8,["data-source","loading"])],4)])}}}),ge=oe(ce,[["__scopeId","data-v-437ca32d"]]);export{ge as default};
