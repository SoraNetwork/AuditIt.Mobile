import{d as oe,r,C as le,o as ie,b as I,f as a,p as k,q as F,i as se,g as s,h as n,H as h,n as v,G as Q,m as re,F as ue,E as de,k as u,l as g}from"./index-BsKy9BNo.js";import{u as me}from"./itemDefinitionStore-33VanGcu.js";import{u as ce}from"./warehouseStore-DYexVObk.js";import pe from"./ItemDefinitionForm-DPTTjaGP.js";import{_ as fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./categoryStore-Cba7xY1q.js";const ve={class:"page-container"},_e=["onClick"],ke={key:0,style:{color:"#888"}},ye=["title"],we=oe({__name:"Inbound",setup(be){const d=r([]),f=r(!1),D=r(!1),y=r(""),S=r(null),V=async()=>{f.value=!0;try{const o=await h.get("/QuickRemarks");d.value=o.data||[]}catch(o){console.error("fetchQuickRemarks",o)}finally{f.value=!1}},L=o=>{if(!o)return;const e=d.value.find(l=>l.id===o);e&&(i.remarks=e.content,setTimeout(()=>{const l=document.querySelector("textarea");l&&l.focus()},100))},B=async()=>{const o=y.value?.trim();if(!o){u.warning("请输入备注内容");return}f.value=!0;try{const e=await h.post("/QuickRemarks",{content:o});d.value.unshift(e.data),y.value="",u.success("添加成功")}catch(e){console.error("createQuickRemark",e),u.error("添加失败")}finally{f.value=!1}},P=async o=>{f.value=!0;try{await h.delete(`/QuickRemarks/${o}`),d.value=d.value.filter(e=>e.id!==o),u.success("已删除")}catch(e){console.error("deleteQuickRemark",e),u.error("删除失败")}finally{f.value=!1}},z=se(),x=me(),R=ce(),w=r("form"),C=r(!1),q=r(),i=le({itemDefinitionId:null,warehouseId:null,quantity:1,remarks:""}),m=r([]),K={itemDefinitionId:[{required:!0,message:"请选择物品定义"}],warehouseId:[{required:!0,message:"请选择仓库"}],quantity:[{required:!0,message:"请输入数量",type:"number",min:1}]},b=r(!1),M=r(null);ie(()=>{x.fetchItemDefinitions(),R.fetchWarehouses(),V()});const W=()=>{q.value?.resetFields(),i.remarks=""},A=async()=>{try{await q.value?.validate();const o=x.itemDefinitions.find(l=>l.id===i.itemDefinitionId),e=R.warehouses.find(l=>l.id===i.warehouseId);for(let l=0;l<i.quantity;l++)m.value.push({tempId:Date.now()+l,itemDefinitionId:i.itemDefinitionId,warehouseId:i.warehouseId,remarks:i.remarks,definitionName:o?.name,warehouseName:e?.name});u.success(`${i.quantity}个物品已添加到待打印列表`),W(),w.value="list"}catch{u.error("请填写所有必填项。")}},E=o=>{m.value.splice(o,1)},j=async()=>{C.value=!0;const o=[];try{for(const l of m.value){const c=new FormData;c.append("itemDefinitionId",l.itemDefinitionId),c.append("warehouseId",l.warehouseId),l.remarks&&c.append("remarks",l.remarks);const p=await h.post("/items/create",c,{headers:{"Content-Type":"multipart/form-data"}});o.push(p.data)}u.success(`${m.value.length}个新物品已成功保存!`);const e=o.map(l=>l.id);console.log("IDs to print (mobile):",e),u.info("请在电脑端进行打印操作。"),m.value=[],w.value="form"}catch(e){u.error("保存过程中发生错误。"),console.error(e)}finally{C.value=!1}},G=o=>{b.value=!1,i.itemDefinitionId=o.id};return(o,e)=>{const l=s("a-page-header"),c=s("a-select"),p=s("a-button"),$=s("a-space-compact"),_=s("a-form-item"),H=s("a-input-number"),J=s("a-textarea"),O=s("a-form"),N=s("a-tab-pane"),X=s("a-list-item-meta"),Y=s("a-list-item"),Z=s("a-list"),ee=s("a-tabs"),T=s("a-drawer"),te=s("a-input"),ae=s("a-space"),ne=s("a-divider");return g(),I("div",null,[a(l,{title:"手动入庫","sub-title":"生成新物品和条码",onBack:e[0]||(e[0]=t=>F(z).back())}),k("div",ve,[a(ee,{activeKey:w.value,"onUpdate:activeKey":e[8]||(e[8]=t=>w.value=t)},{default:n(()=>[a(N,{key:"form",tab:"录入信息"},{default:n(()=>[a(O,{ref_key:"manualFormRef",ref:q,model:i,rules:K,layout:"vertical"},{default:n(()=>[a(_,{label:"物品定义",name:"itemDefinitionId"},{default:n(()=>[a($,{style:{width:"100%"}},{default:n(()=>[a(c,{value:i.itemDefinitionId,"onUpdate:value":e[1]||(e[1]=t=>i.itemDefinitionId=t),"show-search":"",placeholder:"搜索或选择物品定义",options:F(x).itemDefinitions.map(t=>({value:t.id,label:t.name})),style:{width:"calc(100% - 60px)"}},null,8,["value","options"]),a(p,{onClick:e[2]||(e[2]=t=>b.value=!0)},{default:n(()=>e[12]||(e[12]=[v("新建",-1)])),_:1,__:[12]})]),_:1})]),_:1}),a(_,{label:"存放仓库",name:"warehouseId"},{default:n(()=>[a(c,{value:i.warehouseId,"onUpdate:value":e[3]||(e[3]=t=>i.warehouseId=t),placeholder:"选择仓库",options:F(R).warehouses.map(t=>({value:t.id,label:t.name}))},null,8,["value","options"])]),_:1}),a(_,{label:"数量",name:"quantity"},{default:n(()=>[a(H,{value:i.quantity,"onUpdate:value":e[4]||(e[4]=t=>i.quantity=t),min:1,style:{width:"100%"}},null,8,["value"])]),_:1}),a(_,{label:"备注"},{default:n(()=>[a($,{style:{width:"100%"}},{default:n(()=>[a(J,{value:i.remarks,"onUpdate:value":e[5]||(e[5]=t=>i.remarks=t),style:{width:"calc(100% - 180px)"}},null,8,["value"]),a(c,{value:S.value,"onUpdate:value":e[6]||(e[6]=t=>S.value=t),options:d.value.map(t=>({value:t.id,label:t.content.length>16?t.content.slice(0,16)+"…":t.content})),placeholder:"快捷备注",allowClear:"",onChange:L,style:{width:"120px"},dropdownStyle:{maxWidth:"320px"}},null,8,["value","options"]),a(p,{onClick:e[7]||(e[7]=t=>D.value=!0)},{default:n(()=>e[13]||(e[13]=[v("管理",-1)])),_:1,__:[13]})]),_:1})]),_:1}),a(_,null,{default:n(()=>[a(p,{type:"primary",onClick:A,block:""},{default:n(()=>e[14]||(e[14]=[v("添加到待打印列表",-1)])),_:1,__:[14]})]),_:1})]),_:1},8,["model"])]),_:1}),a(N,{key:"list",tab:`待打印列表 (${m.value.length})`},{default:n(()=>[a(p,{type:"primary",onClick:j,loading:C.value,disabled:!m.value.length,block:"",size:"large",style:{"margin-bottom":"16px"}},{default:n(()=>e[15]||(e[15]=[v(" 全部保存并打印 ",-1)])),_:1,__:[15]},8,["loading","disabled"]),a(Z,{"item-layout":"horizontal","data-source":m.value},{renderItem:n(({item:t,index:U})=>[a(Y,null,{actions:n(()=>[k("a",{key:"list-loadmore-edit",onClick:Ie=>E(U),style:{color:"red"}},"移除",8,_e)]),default:n(()=>[a(X,{description:`仓库: ${t.warehouseName}`},{title:n(()=>[v(Q(t.definitionName),1)]),_:2},1032,["description"]),k("div",null,Q(t.remarks),1)]),_:2},1024)]),_:1},8,["data-source"])]),_:1},8,["tab"])]),_:1},8,["activeKey"])]),a(T,{title:"新建物品定义",width:"90%",open:b.value,onClose:e[9]||(e[9]=t=>b.value=!1)},{default:n(()=>[a(pe,{ref_key:"newItemDefFormRef",ref:M,onSubmitted:G},null,512)]),_:1},8,["open"]),a(T,{title:"管理快捷备注",width:"90%",open:D.value,onClose:e[11]||(e[11]=t=>D.value=!1)},{default:n(()=>[k("div",null,[a(ae,{style:{width:"100%","margin-bottom":"12px"}},{default:n(()=>[a(te,{value:y.value,"onUpdate:value":e[10]||(e[10]=t=>y.value=t),placeholder:"请输入新快捷备注"},null,8,["value"]),a(p,{type:"primary",onClick:B,loading:f.value},{default:n(()=>e[16]||(e[16]=[v("添加",-1)])),_:1,__:[16]},8,["loading"])]),_:1}),a(ne),d.value.length?re("",!0):(g(),I("div",ke,"暂无快捷备注")),(g(!0),I(ue,null,de(d.value,t=>(g(),I("div",{key:t.id,style:{display:"flex","justify-content":"space-between","align-items":"center",padding:"6px 0","border-bottom":"1px solid #f0f0f0"}},[k("div",{style:{"max-width":"220px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"},title:t.content},Q(t.content),9,ye),a(p,{type:"text",danger:"",size:"small",onClick:U=>P(t.id)},{default:n(()=>e[17]||(e[17]=[v("删除",-1)])),_:2,__:[17]},1032,["onClick"])]))),128))])]),_:1},8,["open"])])}}}),qe=fe(we,[["__scopeId","data-v-430b7941"]]);export{qe as default};
