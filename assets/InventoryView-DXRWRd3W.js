import{d as W,r as i,C as j,o as z,A as G,B as Q,a as w,m as n,e as a,f as s,w as t,D as q,i as J,F as K,E as X,l,b as N,k as U,p as Y,g as Z,G as u,j as c}from"./index-BF6WkvHV.js";import{u as ee}from"./itemStore-B_i7e9a_.js";import{u as te}from"./warehouseStore-Bo02pPGb.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={InStock:{text:"在库",color:"green"},LoanedOut:{text:"借出",color:"orange"},Disposed:{text:"处置",color:"red"}},se={class:"page-wrapper"},ne={class:"filter-controls"},le={class:"list-item-wrapper"},re={class:"card-title"},ue={key:0},de={class:"item-id"},ie=W({__name:"InventoryView",setup(ce){const V=Z(),y=ee(),h=te(),_=i(!0),v=i([]),x=i([]),p=i(""),d=j({warehouseId:void 0,status:void 0}),g=i(null),k=i("400px"),B=()=>{if(g.value){const r=g.value.offsetHeight,e=60;k.value=`calc(100vh - ${r}px - ${e}px)`}},I=r=>ae[r]||{text:"未知",color:"gray"},C=async()=>{_.value=!0;try{await Promise.all([y.fetchItems({...d}),h.fetchWarehouses()]),v.value=y.items,x.value=h.warehouses}catch(r){console.error("Failed to fetch inventory data:",r),J.error("加载库存数据失败"),v.value=[]}finally{_.value=!1}};z(async()=>{await C(),await G(),B()});const H=Q(()=>{const r=v.value.map(e=>({...e,name:e.itemDefinition?.name||"未知物品",warehouseName:e.warehouse?.name||"未知仓库"}));if(p.value){const e=p.value.toLowerCase();return r.filter(m=>m.name.toLowerCase().includes(e)||m.shortId.toLowerCase().includes(e))}return r}),D=()=>{C()};return(r,e)=>{const m=s("a-page-header"),f=s("a-select-option"),b=s("a-select"),S=s("a-form-item"),L=s("a-col"),T=s("a-row"),F=s("a-form"),A=s("a-input-search"),R=s("a-tag"),$=s("a-card"),E=s("router-link"),M=s("a-button"),O=s("a-empty"),P=s("a-list");return c(),w("div",se,[n("div",{class:"fixed-content",ref_key:"fixedContentRef",ref:g},[a(m,{title:"库存总览","show-back":!1}),n("div",ne,[a(F,{layout:"vertical",model:d},{default:t(()=>[a(T,{gutter:16},{default:t(()=>[a(L,{span:12},{default:t(()=>[a(S,null,{default:t(()=>[a(b,{value:d.warehouseId,"onUpdate:value":e[0]||(e[0]=o=>d.warehouseId=o),placeholder:"所有仓库","allow-clear":"",onChange:D},{default:t(()=>[(c(!0),w(K,null,X(x.value,o=>(c(),N(f,{key:o.id,value:o.id},{default:t(()=>[l(u(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),a(L,{span:12},{default:t(()=>[a(S,null,{default:t(()=>[a(b,{value:d.status,"onUpdate:value":e[1]||(e[1]=o=>d.status=o),placeholder:"所有状态","allow-clear":"",onChange:D},{default:t(()=>[a(f,{value:"InStock"},{default:t(()=>e[4]||(e[4]=[l("在库",-1)])),_:1,__:[4]}),a(f,{value:"LoanedOut"},{default:t(()=>e[5]||(e[5]=[l("借出",-1)])),_:1,__:[5]}),a(f,{value:"Disposed"},{default:t(()=>e[6]||(e[6]=[l("处置",-1)])),_:1,__:[6]})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),a(A,{value:p.value,"onUpdate:value":e[2]||(e[2]=o=>p.value=o),placeholder:"通过ID或名称搜索..."},null,8,["value"])])],512),n("div",{class:"scrollable-content",style:q({height:k.value})},[a(P,{"data-source":H.value,loading:_.value,split:!1},{renderItem:t(({item:o})=>[n("div",le,[a(E,{to:{name:"item-details",params:{id:o.id}}},{default:t(()=>[a($,{hoverable:""},{title:t(()=>[n("span",re,u(o.name),1)]),extra:t(()=>[a(R,{color:I(o.status).color},{default:t(()=>[l(u(I(o.status).text),1)]),_:2},1032,["color"])]),default:t(()=>[n("p",null,[e[7]||(e[7]=n("strong",null,"可视化ID:",-1)),l(" "+u(o.shortId),1)]),n("p",null,[e[8]||(e[8]=n("strong",null,"所在仓库:",-1)),l(" "+u(o.warehouseName),1)]),o.remarks?(c(),w("p",ue,[e[9]||(e[9]=n("strong",null,"备注:",-1)),l(" "+u(o.remarks),1)])):U("",!0),n("p",de,[e[10]||(e[10]=n("strong",null,"UUID:",-1)),l(" "+u(o.id),1)])]),_:2},1024)]),_:2},1032,["to"])])]),empty:t(()=>[_.value?U("",!0):(c(),N(O,{key:0,description:"没有找到物品"},{default:t(()=>[a(M,{type:"primary",onClick:e[3]||(e[3]=o=>Y(V).push("/inbound"))},{default:t(()=>e[11]||(e[11]=[l("立即入库",-1)])),_:1,__:[11]})]),_:1}))]),_:1},8,["data-source","loading"])],4)])}}}),ve=oe(ie,[["__scopeId","data-v-17dcd3b3"]]);export{ve as default};
