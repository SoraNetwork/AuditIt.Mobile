import{d as F,r as g,j as O,B as w,H as j,o as q,A as E,b as d,p as h,e as D,m as b,q as u,i as G,f as a,g as o,h as s,D as M,n as r,G as l,l as i}from"./index-DmVvMhTu.js";import{u as J}from"./itemStore-CPreGeyO.js";import{u as K,f as y}from"./formatters-CkGML3S-.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./v4-BKrj-4V8.js";const W={class:"page-wrapper"},X={key:1,class:"details-section"},Y={key:0,class:"photo-container"},Z={key:0,class:"loading-container"},ee={class:"list-item-wrapper"},te=F({__name:"ItemDetails",setup(ae){const S=O(),C=G(),x=J(),m=K(),_=g(!0),p=S.params.id,f=g(null),k=g("300px"),e=w(()=>x.items.find(t=>t.id===p)),I=w(()=>e.value?.photoUrl?`${(j.defaults.baseURL||"").replace("/api","")}${e.value.photoUrl}`:null),L=()=>{if(f.value){const t=f.value.offsetHeight,n=60;k.value=`calc(100vh - ${t}px - ${n}px)`}};q(async()=>{_.value=!0,m.logs=[];try{const t=e.value?Promise.resolve():x.fetchItems({id:p}),n=m.fetchLogs({itemId:p});await Promise.all([t,n])}catch(t){console.error("Failed to load item details:",t)}finally{_.value=!1,await E(),L()}});const U=t=>{switch(t){case"InStock":return"success";case"LoanedOut":return"warning";case"Disposed":return"error";default:return"default"}},B=t=>{switch(t){case"InStock":return"在库";case"LoanedOut":return"已借出";case"Disposed":return"已处置";default:return"未知"}};return(t,n)=>{const H=o("a-page-header"),N=o("a-image"),c=o("a-descriptions-item"),R=o("a-badge"),P=o("a-descriptions"),T=o("a-spin"),V=o("a-list-item-meta"),$=o("a-card"),z=o("a-list"),A=o("a-empty");return i(),d("div",W,[h("div",{class:"fixed-content",ref_key:"fixedContentRef",ref:f},[e.value?(i(),D(H,{key:0,title:e.value.itemDefinition?.name,onBack:n[0]||(n[0]=()=>u(C).back())},null,8,["title"])):b("",!0),!_.value&&e.value?(i(),d("div",X,[I.value?(i(),d("div",Y,[a(N,{width:"100%",src:I.value,alt:"物品图片"},null,8,["src"])])):b("",!0),a(P,{bordered:"",column:1,style:{"margin-top":"16px"}},{default:s(()=>[a(c,{label:"短ID"},{default:s(()=>[r(l(e.value.shortId),1)]),_:1}),a(c,{label:"状态"},{default:s(()=>[a(R,{status:U(e.value.status),text:B(e.value.status)},null,8,["status","text"])]),_:1}),a(c,{label:"仓库"},{default:s(()=>[r(l(e.value.warehouse?.name),1)]),_:1}),a(c,{label:"备注"},{default:s(()=>[r(l(e.value.remarks||"无"),1)]),_:1}),a(c,{label:"入库日期"},{default:s(()=>[r(l(u(y)(e.value.entryDate)),1)]),_:1}),a(c,{label:"最后更新"},{default:s(()=>[r(l(u(y)(e.value.lastUpdated)),1)]),_:1})]),_:1})])):b("",!0)],512),_.value?(i(),d("div",Z,[a(T,{size:"large"})])):e.value?(i(),d("div",{key:1,class:"scrollable-content",style:M({height:k.value})},[n[1]||(n[1]=h("h3",{class:"log-title"},"操作历史",-1)),a(z,{loading:u(m).loading,"data-source":u(m).logs,split:!1},{renderItem:s(({item:v})=>[h("div",ee,[a($,null,{default:s(()=>[a(V,null,{title:s(()=>[r(l(v.action)+" - by "+l(v.user),1)]),description:s(()=>[r(l(u(y)(v.timestamp)),1)]),_:2},1024)]),_:2},1024)])]),_:1},8,["loading","data-source"])],4)):(i(),D(A,{key:2}))])}}}),ie=Q(te,[["__scopeId","data-v-8f034cce"]]);export{ie as default};
