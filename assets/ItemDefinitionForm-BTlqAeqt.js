import{d as U,r as v,C as V,B as j,o as E,j as T,b,f as t,p as G,g as i,h as n,q as p,F as L,E as M,n as y,i as O,l as f,e as z,G as A,k as _}from"./index-BrlnX8tt.js";import{u as H}from"./itemDefinitionStore-DEa_faNp.js";import{u as J}from"./categoryStore-DL_15DCc.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const P={class:"form-container"},Q=U({__name:"ItemDefinitionForm",emits:["submitted"],setup(W,{emit:I}){const k=I,D=T(),g=O(),l=H(),u=J(),x=v(),a=V({name:"",categoryId:void 0,unit:"个",description:""}),m=v(null),B=j(()=>m.value?"编辑物品定义":"添加物品定义"),C={name:[{required:!0,message:"请输入物品名称！"}],categoryId:[{required:!0,message:"请选择一个分类！"}],unit:[{required:!0,message:"请输入单位！"}]};E(()=>{u.categories.length===0&&u.fetchCategories();const s=D.params.id;if(s&&typeof s=="string"){m.value=s;const e=Number(s),d=l.itemDefinitions.find(c=>c.id===e);d&&Object.assign(a,d)}});const S=async s=>{try{if(m.value)await l.updateItemDefinition({id:Number(m.value),...s}),_.success("物品定义更新成功"),g.back();else{const e=await l.addItemDefinition(s);_.success("物品定义添加成功"),k("submitted",e)}}catch{_.error("保存失败")}},h=()=>{g.back()};return(s,e)=>{const d=i("a-page-header"),c=i("a-input"),r=i("a-form-item"),F=i("a-select-option"),N=i("a-select"),q=i("a-textarea"),w=i("a-button"),R=i("a-form");return f(),b("div",null,[t(d,{title:B.value,onBack:h},null,8,["title"]),G("div",P,[t(R,{ref_key:"formRef",ref:x,model:a,rules:C,layout:"vertical",onFinish:S},{default:n(()=>[t(r,{label:"物品名称",name:"name"},{default:n(()=>[t(c,{value:a.name,"onUpdate:value":e[0]||(e[0]=o=>a.name=o),placeholder:"请输入物品名称"},null,8,["value"])]),_:1}),t(r,{label:"分类",name:"categoryId"},{default:n(()=>[t(N,{value:a.categoryId,"onUpdate:value":e[1]||(e[1]=o=>a.categoryId=o),placeholder:"请选择一个分类",loading:p(u).loading},{default:n(()=>[(f(!0),b(L,null,M(p(u).categories,o=>(f(),z(F,{key:o.id,value:o.id},{default:n(()=>[y(A(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading"])]),_:1}),t(r,{label:"单位",name:"unit"},{default:n(()=>[t(c,{value:a.unit,"onUpdate:value":e[2]||(e[2]=o=>a.unit=o),placeholder:"例如: 个, 箱, 千克"},null,8,["value"])]),_:1}),t(r,{label:"描述",name:"description"},{default:n(()=>[t(q,{value:a.description,"onUpdate:value":e[3]||(e[3]=o=>a.description=o),placeholder:"请输入描述"},null,8,["value"])]),_:1}),t(r,null,{default:n(()=>[t(w,{type:"primary","html-type":"submit",loading:p(l).loading,block:""},{default:n(()=>e[4]||(e[4]=[y(" 保存 ",-1)])),_:1,__:[4]},8,["loading"])]),_:1})]),_:1},8,["model"])])])}}}),ee=K(Q,[["__scopeId","data-v-9b593b54"]]);export{ee as default};
