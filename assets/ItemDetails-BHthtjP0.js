import{d as A,r as v,h as F,B as w,H as O,o as j,A as E,a as u,m as g,b as S,k as h,p as b,g as G,e as a,f as o,w as s,D as M,l as r,G as l,j as i}from"./index-CxbuQvp9.js";import{u as q}from"./itemStore-1VtvICAF.js";import{u as J}from"./auditLogStore-CpW8Jnh-.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./v4-BKrj-4V8.js";const Q={class:"page-wrapper"},W={key:1,class:"details-section"},X={key:0,class:"photo-container"},Y={key:0,class:"loading-container"},Z={class:"list-item-wrapper"},ee=A({__name:"ItemDetails",setup(te){const D=F(),I=G(),y=q(),d=J(),m=v(!0),_=D.params.id,p=v(null),k=v("300px"),e=w(()=>y.items.find(t=>t.id===_)),x=w(()=>e.value?.photoUrl?`${(O.defaults.baseURL||"").replace("/api","")}${e.value.photoUrl}`:null),L=()=>{if(p.value){const t=p.value.offsetHeight,n=60;k.value=`calc(100vh - ${t}px - ${n}px)`}};j(async()=>{m.value=!0,d.logs=[];try{const t=e.value?Promise.resolve():y.fetchItems({id:_}),n=d.fetchLogs({itemId:_});await Promise.all([t,n])}catch(t){console.error("Failed to load item details:",t)}finally{m.value=!1,await E(),L()}});const C=t=>{switch(t){case"InStock":return"success";case"LoanedOut":return"warning";case"Disposed":return"error";default:return"default"}},U=t=>{switch(t){case"InStock":return"在库";case"LoanedOut":return"已借出";case"Disposed":return"已处置";default:return"未知"}};return(t,n)=>{const B=o("a-page-header"),H=o("a-image"),c=o("a-descriptions-item"),N=o("a-badge"),R=o("a-descriptions"),P=o("a-spin"),V=o("a-list-item-meta"),$=o("a-card"),T=o("a-list"),z=o("a-empty");return i(),u("div",Q,[g("div",{class:"fixed-content",ref_key:"fixedContentRef",ref:p},[e.value?(i(),S(B,{key:0,title:e.value.itemDefinition?.name,onBack:n[0]||(n[0]=()=>b(I).back())},null,8,["title"])):h("",!0),!m.value&&e.value?(i(),u("div",W,[x.value?(i(),u("div",X,[a(H,{width:"100%",src:x.value,alt:"物品图片"},null,8,["src"])])):h("",!0),a(R,{bordered:"",column:1,style:{"margin-top":"16px"}},{default:s(()=>[a(c,{label:"短ID"},{default:s(()=>[r(l(e.value.shortId),1)]),_:1}),a(c,{label:"状态"},{default:s(()=>[a(N,{status:C(e.value.status),text:U(e.value.status)},null,8,["status","text"])]),_:1}),a(c,{label:"仓库"},{default:s(()=>[r(l(e.value.warehouse?.name),1)]),_:1}),a(c,{label:"备注"},{default:s(()=>[r(l(e.value.remarks||"无"),1)]),_:1}),a(c,{label:"入库日期"},{default:s(()=>[r(l(new Date(e.value.entryDate).toLocaleString()),1)]),_:1}),a(c,{label:"最后更新"},{default:s(()=>[r(l(new Date(e.value.lastUpdated).toLocaleString()),1)]),_:1})]),_:1})])):h("",!0)],512),m.value?(i(),u("div",Y,[a(P,{size:"large"})])):e.value?(i(),u("div",{key:1,class:"scrollable-content",style:M({height:k.value})},[n[1]||(n[1]=g("h3",{class:"log-title"},"操作历史",-1)),a(T,{loading:b(d).loading,"data-source":b(d).logs,split:!1},{renderItem:s(({item:f})=>[g("div",Z,[a($,null,{default:s(()=>[a(V,null,{title:s(()=>[r(l(f.action)+" - by "+l(f.user),1)]),description:s(()=>[r(l(new Date(f.timestamp).toLocaleString()),1)]),_:2},1024)]),_:2},1024)])]),_:1},8,["loading","data-source"])],4)):(i(),S(z,{key:2}))])}}}),re=K(ee,[["__scopeId","data-v-890620e0"]]);export{re as default};
