import{d as A,r as g,h as F,B as w,H as O,o as j,A as E,a as u,m as h,b as D,k as b,p as _,g as G,e as a,f as o,w as s,D as M,l as r,G as l,j as i}from"./index-DntWIyR_.js";import{u as q}from"./itemStore-B4LCrHR-.js";import{u as J,f as K}from"./formatters-1tuVnvAB.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./v4-BKrj-4V8.js";const W={class:"page-wrapper"},X={key:1,class:"details-section"},Y={key:0,class:"photo-container"},Z={key:0,class:"loading-container"},ee={class:"list-item-wrapper"},te=A({__name:"ItemDetails",setup(ae){const I=F(),S=G(),y=q(),d=J(),m=g(!0),p=I.params.id,f=g(null),k=g("300px"),e=w(()=>y.items.find(t=>t.id===p)),x=w(()=>e.value?.photoUrl?`${(O.defaults.baseURL||"").replace("/api","")}${e.value.photoUrl}`:null),L=()=>{if(f.value){const t=f.value.offsetHeight,n=60;k.value=`calc(100vh - ${t}px - ${n}px)`}};j(async()=>{m.value=!0,d.logs=[];try{const t=e.value?Promise.resolve():y.fetchItems({id:p}),n=d.fetchLogs({itemId:p});await Promise.all([t,n])}catch(t){console.error("Failed to load item details:",t)}finally{m.value=!1,await E(),L()}});const C=t=>{switch(t){case"InStock":return"success";case"LoanedOut":return"warning";case"Disposed":return"error";default:return"default"}},U=t=>{switch(t){case"InStock":return"在库";case"LoanedOut":return"已借出";case"Disposed":return"已处置";default:return"未知"}};return(t,n)=>{const B=o("a-page-header"),H=o("a-image"),c=o("a-descriptions-item"),N=o("a-badge"),R=o("a-descriptions"),P=o("a-spin"),T=o("a-list-item-meta"),V=o("a-card"),$=o("a-list"),z=o("a-empty");return i(),u("div",W,[h("div",{class:"fixed-content",ref_key:"fixedContentRef",ref:f},[e.value?(i(),D(B,{key:0,title:e.value.itemDefinition?.name,onBack:n[0]||(n[0]=()=>_(S).back())},null,8,["title"])):b("",!0),!m.value&&e.value?(i(),u("div",X,[x.value?(i(),u("div",Y,[a(H,{width:"100%",src:x.value,alt:"物品图片"},null,8,["src"])])):b("",!0),a(R,{bordered:"",column:1,style:{"margin-top":"16px"}},{default:s(()=>[a(c,{label:"短ID"},{default:s(()=>[r(l(e.value.shortId),1)]),_:1}),a(c,{label:"状态"},{default:s(()=>[a(N,{status:C(e.value.status),text:U(e.value.status)},null,8,["status","text"])]),_:1}),a(c,{label:"仓库"},{default:s(()=>[r(l(e.value.warehouse?.name),1)]),_:1}),a(c,{label:"备注"},{default:s(()=>[r(l(e.value.remarks||"无"),1)]),_:1}),a(c,{label:"入库日期"},{default:s(()=>[r(l(new Date(e.value.entryDate).toLocaleString()),1)]),_:1}),a(c,{label:"最后更新"},{default:s(()=>[r(l(new Date(e.value.lastUpdated).toLocaleString()),1)]),_:1})]),_:1})])):b("",!0)],512),m.value?(i(),u("div",Z,[a(P,{size:"large"})])):e.value?(i(),u("div",{key:1,class:"scrollable-content",style:M({height:k.value})},[n[1]||(n[1]=h("h3",{class:"log-title"},"操作历史",-1)),a($,{loading:_(d).loading,"data-source":_(d).logs,split:!1},{renderItem:s(({item:v})=>[h("div",ee,[a(V,null,{default:s(()=>[a(T,null,{title:s(()=>[r(l(v.action)+" - by "+l(v.user),1)]),description:s(()=>[r(l(_(K)(v.timestamp)),1)]),_:2},1024)]),_:2},1024)])]),_:1},8,["loading","data-source"])],4)):(i(),D(z,{key:2}))])}}}),ie=Q(te,[["__scopeId","data-v-ce84664b"]]);export{ie as default};
