import{d as W,r as m,C as j,o as E,a as G,e as t,m as k,p as D,g as H,f as s,w as n,l as v,G as g,i as f,M as J,j as O}from"./index-DE23a1j6.js";import{u as Q}from"./itemDefinitionStore-jXQURWqF.js";import{u as X}from"./warehouseStore-CCpt9oGM.js";import Y from"./ItemDefinitionForm-P_xB2AdQ.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./categoryStore-BFA2EVUs.js";const ee={class:"page-container"},te=["onClick"],ae=W({__name:"Inbound",setup(oe){const C=H(),I=Q(),b=X(),c=m("form"),y=m(!1),w=m(),o=j({itemDefinitionId:null,warehouseId:null,quantity:1,remarks:""}),r=m([]),F={itemDefinitionId:[{required:!0,message:"请选择物品定义"}],warehouseId:[{required:!0,message:"请选择仓库"}],quantity:[{required:!0,message:"请输入数量",type:"number",min:1}]},_=m(!1),q=m(null);E(()=>{I.fetchItemDefinitions(),b.fetchWarehouses()});const S=()=>{w.value?.resetFields(),o.remarks=""},x=async()=>{try{await w.value?.validate();const l=I.itemDefinitions.find(i=>i.id===o.itemDefinitionId),e=b.warehouses.find(i=>i.id===o.warehouseId);for(let i=0;i<o.quantity;i++)r.value.push({tempId:Date.now()+i,itemDefinitionId:o.itemDefinitionId,warehouseId:o.warehouseId,remarks:o.remarks,definitionName:l?.name,warehouseName:e?.name});f.success(`${o.quantity}个物品已添加到待打印列表`),S(),c.value="list"}catch{f.error("请填写所有必填项。")}},N=l=>{r.value.splice(l,1)},$=async()=>{y.value=!0;const l=[];try{for(const i of r.value){const u=new FormData;u.append("itemDefinitionId",i.itemDefinitionId),u.append("warehouseId",i.warehouseId),i.remarks&&u.append("remarks",i.remarks);const d=await J.post("/items/create",u,{headers:{"Content-Type":"multipart/form-data"}});l.push(d.data)}f.success(`${r.value.length}个新物品已成功保存!`);const e=l.map(i=>i.id);console.log("IDs to print (mobile):",e),f.info("请在电脑端进行打印操作。"),r.value=[],c.value="form"}catch(e){f.error("保存过程中发生错误。"),console.error(e)}finally{y.value=!1}},R=l=>{_.value=!1,o.itemDefinitionId=l.id};return(l,e)=>{const i=s("a-page-header"),u=s("a-select"),d=s("a-button"),T=s("a-space-compact"),p=s("a-form-item"),U=s("a-input-number"),B=s("a-textarea"),P=s("a-form"),h=s("a-tab-pane"),V=s("a-list-item-meta"),K=s("a-list-item"),L=s("a-list"),M=s("a-tabs"),z=s("a-drawer");return O(),G("div",null,[t(i,{title:"手动入庫","sub-title":"生成新物品和条码",onBack:e[0]||(e[0]=a=>D(C).back())}),k("div",ee,[t(M,{activeKey:c.value,"onUpdate:activeKey":e[6]||(e[6]=a=>c.value=a)},{default:n(()=>[t(h,{key:"form",tab:"录入信息"},{default:n(()=>[t(P,{ref_key:"manualFormRef",ref:w,model:o,rules:F,layout:"vertical"},{default:n(()=>[t(p,{label:"物品定义",name:"itemDefinitionId"},{default:n(()=>[t(T,{style:{width:"100%"}},{default:n(()=>[t(u,{value:o.itemDefinitionId,"onUpdate:value":e[1]||(e[1]=a=>o.itemDefinitionId=a),"show-search":"",placeholder:"搜索或选择物品定义",options:D(I).itemDefinitions.map(a=>({value:a.id,label:a.name})),style:{width:"calc(100% - 60px)"}},null,8,["value","options"]),t(d,{onClick:e[2]||(e[2]=a=>_.value=!0)},{default:n(()=>e[8]||(e[8]=[v("新建",-1)])),_:1,__:[8]})]),_:1})]),_:1}),t(p,{label:"存放仓库",name:"warehouseId"},{default:n(()=>[t(u,{value:o.warehouseId,"onUpdate:value":e[3]||(e[3]=a=>o.warehouseId=a),placeholder:"选择仓库",options:D(b).warehouses.map(a=>({value:a.id,label:a.name}))},null,8,["value","options"])]),_:1}),t(p,{label:"数量",name:"quantity"},{default:n(()=>[t(U,{value:o.quantity,"onUpdate:value":e[4]||(e[4]=a=>o.quantity=a),min:1,style:{width:"100%"}},null,8,["value"])]),_:1}),t(p,{label:"备注"},{default:n(()=>[t(B,{value:o.remarks,"onUpdate:value":e[5]||(e[5]=a=>o.remarks=a)},null,8,["value"])]),_:1}),t(p,null,{default:n(()=>[t(d,{type:"primary",onClick:x,block:""},{default:n(()=>e[9]||(e[9]=[v("添加到待打印列表",-1)])),_:1,__:[9]})]),_:1})]),_:1},8,["model"])]),_:1}),t(h,{key:"list",tab:`待打印列表 (${r.value.length})`},{default:n(()=>[t(d,{type:"primary",onClick:$,loading:y.value,disabled:!r.value.length,block:"",size:"large",style:{"margin-bottom":"16px"}},{default:n(()=>e[10]||(e[10]=[v(" 全部保存并打印 ",-1)])),_:1,__:[10]},8,["loading","disabled"]),t(L,{"item-layout":"horizontal","data-source":r.value},{renderItem:n(({item:a,index:A})=>[t(K,null,{actions:n(()=>[k("a",{key:"list-loadmore-edit",onClick:ne=>N(A),style:{color:"red"}},"移除",8,te)]),default:n(()=>[t(V,{description:`仓库: ${a.warehouseName}`},{title:n(()=>[v(g(a.definitionName),1)]),_:2},1032,["description"]),k("div",null,g(a.remarks),1)]),_:2},1024)]),_:1},8,["data-source"])]),_:1},8,["tab"])]),_:1},8,["activeKey"])]),t(z,{title:"新建物品定义",width:"90%",open:_.value,onClose:e[7]||(e[7]=a=>_.value=!1)},{default:n(()=>[t(Y,{ref_key:"newItemDefFormRef",ref:q,onSubmitted:R},null,512)]),_:1},8,["open"])])}}}),de=Z(ae,[["__scopeId","data-v-cb7fba45"]]);export{de as default};
