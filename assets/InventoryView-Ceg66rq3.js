import{d as P,r as i,C as W,o as j,A as z,B as G,a as L,m as n,e as a,f as s,w as t,D as Q,i as q,F as J,E as K,l as r,b as N,k as X,p as Y,g as Z,G as d,j as f}from"./index-BIP7TFCp.js";import{u as ee}from"./itemStore-B0Gz8XmX.js";import{u as te}from"./warehouseStore-DKCw_Cn_.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={InStock:{text:"在库",color:"green"},LoanedOut:{text:"借出",color:"orange"},Disposed:{text:"处置",color:"red"}},se={class:"page-wrapper"},ne={class:"filter-controls"},le={class:"list-item-wrapper"},re={class:"card-title"},ue={class:"item-id"},ie=P({__name:"InventoryView",setup(de){const U=Z(),w=ee(),y=te(),c=i(!0),v=i([]),h=i([]),_=i(""),u=W({warehouseId:void 0,status:void 0}),g=i(null),x=i("400px"),V=()=>{if(g.value){const l=g.value.offsetHeight,e=60;x.value=`calc(100vh - ${l}px - ${e}px)`}},I=l=>ae[l]||{text:"未知",color:"gray"},k=async()=>{c.value=!0;try{await Promise.all([w.fetchItems({...u}),y.fetchWarehouses()]),v.value=w.items,h.value=y.warehouses}catch(l){console.error("Failed to fetch inventory data:",l),q.error("加载库存数据失败"),v.value=[]}finally{c.value=!1}};j(async()=>{await k(),await z(),V()});const B=G(()=>{const l=v.value.map(e=>({...e,name:e.itemDefinition?.name||"未知物品",warehouseName:e.warehouse?.name||"未知仓库"}));if(_.value){const e=_.value.toLowerCase();return l.filter(p=>p.name.toLowerCase().includes(e)||p.shortId.toLowerCase().includes(e))}return l}),C=()=>{k()};return(l,e)=>{const p=s("a-page-header"),m=s("a-select-option"),D=s("a-select"),b=s("a-form-item"),S=s("a-col"),H=s("a-row"),T=s("a-form"),F=s("a-input-search"),A=s("a-tag"),R=s("a-card"),$=s("router-link"),E=s("a-button"),M=s("a-empty"),O=s("a-list");return f(),L("div",se,[n("div",{class:"fixed-content",ref_key:"fixedContentRef",ref:g},[a(p,{title:"库存总览","show-back":!1}),n("div",ne,[a(T,{layout:"vertical",model:u},{default:t(()=>[a(H,{gutter:16},{default:t(()=>[a(S,{span:12},{default:t(()=>[a(b,null,{default:t(()=>[a(D,{value:u.warehouseId,"onUpdate:value":e[0]||(e[0]=o=>u.warehouseId=o),placeholder:"所有仓库","allow-clear":"",onChange:C},{default:t(()=>[(f(!0),L(J,null,K(h.value,o=>(f(),N(m,{key:o.id,value:o.id},{default:t(()=>[r(d(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),a(S,{span:12},{default:t(()=>[a(b,null,{default:t(()=>[a(D,{value:u.status,"onUpdate:value":e[1]||(e[1]=o=>u.status=o),placeholder:"所有状态","allow-clear":"",onChange:C},{default:t(()=>[a(m,{value:"InStock"},{default:t(()=>e[4]||(e[4]=[r("在库",-1)])),_:1,__:[4]}),a(m,{value:"LoanedOut"},{default:t(()=>e[5]||(e[5]=[r("借出",-1)])),_:1,__:[5]}),a(m,{value:"Disposed"},{default:t(()=>e[6]||(e[6]=[r("处置",-1)])),_:1,__:[6]})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),a(F,{value:_.value,"onUpdate:value":e[2]||(e[2]=o=>_.value=o),placeholder:"通过ID或名称搜索..."},null,8,["value"])])],512),n("div",{class:"scrollable-content",style:Q({height:x.value})},[a(O,{"data-source":B.value,loading:c.value,split:!1},{renderItem:t(({item:o})=>[n("div",le,[a($,{to:{name:"item-details",params:{id:o.id}}},{default:t(()=>[a(R,{hoverable:""},{title:t(()=>[n("span",re,d(o.name),1)]),extra:t(()=>[a(A,{color:I(o.status).color},{default:t(()=>[r(d(I(o.status).text),1)]),_:2},1032,["color"])]),default:t(()=>[n("p",null,[e[7]||(e[7]=n("strong",null,"可视化ID:",-1)),r(" "+d(o.shortId),1)]),n("p",null,[e[8]||(e[8]=n("strong",null,"所在仓库:",-1)),r(" "+d(o.warehouseName),1)]),n("p",ue,[e[9]||(e[9]=n("strong",null,"UUID:",-1)),r(" "+d(o.id),1)])]),_:2},1024)]),_:2},1032,["to"])])]),empty:t(()=>[c.value?X("",!0):(f(),N(M,{key:0,description:"没有找到物品"},{default:t(()=>[a(E,{type:"primary",onClick:e[3]||(e[3]=o=>Y(U).push("/inbound"))},{default:t(()=>e[10]||(e[10]=[r("立即入库",-1)])),_:1,__:[10]})]),_:1}))]),_:1},8,["data-source","loading"])],4)])}}}),fe=oe(ie,[["__scopeId","data-v-bf3f83d3"]]);export{fe as default};
