import{U as d,H as n}from"./index-DdZCSEGE.js";const p=d("item",{state:()=>({items:[],loading:!1,error:null}),actions:{async fetchItems(e={}){this.loading=!0,this.error=null;try{const t=new URLSearchParams;e.warehouseId&&t.append("warehouseId",e.warehouseId.toString()),e.status&&t.append("status",e.status),e.id&&t.append("id",e.id),e.shortId&&t.append("shortId",e.shortId);const s=await n.get(`/items?${t.toString()}`);this.items=s.data}catch(t){this.error="获取库存物品失败: "+(t.response?.data?.message||t.message)}finally{this.loading=!1}},async createItem(e){this.loading=!0,this.error=null;try{const t=new FormData;t.append("itemDefinitionId",String(e.itemDefinitionId)),t.append("warehouseId",String(e.warehouseId)),e.shortId&&t.append("shortId",e.shortId),e.remarks&&t.append("remarks",e.remarks),e.photo&&t.append("photo",e.photo);const s=await n.post("/items/create",t);return this.items.unshift(s.data),s.data}catch(t){throw this.error="创建物品失败: "+(t.response?.data?.message||t.message),t}finally{this.loading=!1}},async updateItem(e,t){this.loading=!0,this.error=null;try{const s=new FormData;s.append("remarks",t.remarks||""),t.currentDestination&&s.append("currentDestination",t.currentDestination),t.photo?s.append("photo",t.photo):t.deletePhoto&&s.append("deletePhoto","true"),await n.put(`/items/${e}`,s),await this.fetchItems({id:e})}catch(s){throw this.error="更新物品失败: "+(s.response?.data?.message||s.message),s}finally{this.loading=!1}},async transferWarehouse(e,t,s){this.loading=!0,this.error=null;try{const r=await n.put(`/items/${e}/transfer`,{newWarehouseId:t,remarks:s}),i=this.items.findIndex(a=>a.id===e);return i!==-1&&(this.items[i]=r.data),r.data}catch(r){throw this.error="转移库房失败: "+(r.response?.data?.message||r.message),r}finally{this.loading=!1}},async transferWarehouseBatch(e,t,s){this.loading=!0,this.error=null;try{const r=e.map(a=>n.put(`/items/${a}/transfer`,{newWarehouseId:t,remarks:s})),i=await Promise.all(r);return i.forEach(a=>{const o=this.items.findIndex(h=>h.id===a.data.id);o!==-1&&(this.items[o]=a.data)}),i.map(a=>a.data)}catch(r){throw this.error="批量转移库房失败: "+(r.response?.data?.message||r.message),r}finally{this.loading=!1}},async updateItemStatus(e,t,s){this.loading=!0,this.error=null;try{const r=await n.put(`/items/${e}/${t}`,{destination:s}),i=this.items.findIndex(a=>a.id===e);i!==-1&&(this.items[i]=r.data)}catch(r){throw this.error=`物品操作 '${t}' 失败: `+(r.response?.data?.message||r.message),r}finally{this.loading=!1}},async updateStatusBatch(e,t){this.loading=!0,this.error=null;try{await n.post("/items/update-status/batch",{itemIds:e,status:t}),this.items=this.items.map(s=>e.includes(s.id)?{...s,status:t}:s)}catch(s){throw this.error="批量更新状态失败: "+(s.response?.data?.message||s.message),s}finally{this.loading=!1}}}});export{p as u};
