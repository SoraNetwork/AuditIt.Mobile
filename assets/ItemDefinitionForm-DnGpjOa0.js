import{d as q,r as v,C as V,B as j,o as E,h as T,a as b,e as t,m as G,f as i,w as n,p,F as L,E as M,l as y,g as O,j as f,b as z,G as A,i as _}from"./index-CPmBGEV4.js";import{u as H}from"./itemDefinitionStore-Cy9pIDd4.js";import{u as J}from"./categoryStore-DnaAISe7.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const P={class:"form-container"},Q=q({__name:"ItemDefinitionForm",emits:["submitted"],setup(W,{emit:I}){const k=I,D=T(),g=O(),l=H(),u=J(),x=v(),o=V({name:"",categoryId:void 0,unit:"个",description:""}),m=v(null),B=j(()=>m.value?"编辑物品定义":"添加物品定义"),C={name:[{required:!0,message:"请输入物品名称！"}],categoryId:[{required:!0,message:"请选择一个分类！"}],unit:[{required:!0,message:"请输入单位！"}]};E(()=>{u.categories.length===0&&u.fetchCategories();const s=D.params.id;if(s&&typeof s=="string"){m.value=s;const e=Number(s),d=l.itemDefinitions.find(c=>c.id===e);d&&Object.assign(o,d)}});const S=async s=>{try{if(m.value)await l.updateItemDefinition({id:Number(m.value),...s}),_.success("物品定义更新成功"),g.back();else{const e=await l.addItemDefinition(s);_.success("物品定义添加成功"),k("submitted",e)}}catch{_.error("保存失败")}},h=()=>{g.back()};return(s,e)=>{const d=i("a-page-header"),c=i("a-input"),r=i("a-form-item"),w=i("a-select-option"),F=i("a-select"),N=i("a-textarea"),R=i("a-button"),U=i("a-form");return f(),b("div",null,[t(d,{title:B.value,onBack:h},null,8,["title"]),G("div",P,[t(U,{ref_key:"formRef",ref:x,model:o,rules:C,layout:"vertical",onFinish:S},{default:n(()=>[t(r,{label:"物品名称",name:"name"},{default:n(()=>[t(c,{value:o.name,"onUpdate:value":e[0]||(e[0]=a=>o.name=a),placeholder:"请输入物品名称"},null,8,["value"])]),_:1}),t(r,{label:"分类",name:"categoryId"},{default:n(()=>[t(F,{value:o.categoryId,"onUpdate:value":e[1]||(e[1]=a=>o.categoryId=a),placeholder:"请选择一个分类",loading:p(u).loading},{default:n(()=>[(f(!0),b(L,null,M(p(u).categories,a=>(f(),z(w,{key:a.id,value:a.id},{default:n(()=>[y(A(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading"])]),_:1}),t(r,{label:"单位",name:"unit"},{default:n(()=>[t(c,{value:o.unit,"onUpdate:value":e[2]||(e[2]=a=>o.unit=a),placeholder:"例如: 个, 箱, 千克"},null,8,["value"])]),_:1}),t(r,{label:"描述",name:"description"},{default:n(()=>[t(N,{value:o.description,"onUpdate:value":e[3]||(e[3]=a=>o.description=a),placeholder:"请输入描述"},null,8,["value"])]),_:1}),t(r,null,{default:n(()=>[t(R,{type:"primary","html-type":"submit",loading:p(l).loading,block:""},{default:n(()=>e[4]||(e[4]=[y(" 保存 ",-1)])),_:1,__:[4]},8,["loading"])]),_:1})]),_:1},8,["model"])])])}}}),ee=K(Q,[["__scopeId","data-v-9b593b54"]]);export{ee as default};
