import{d as w,r as p,o as M,A as $,b as B,f as s,p as m,q as I,i as T,g as o,h as r,Q as V,n as N,G as f,V as R,k as h,l as z}from"./index-_bN1VAA4.js";import{u as E}from"./itemStore-CNXsx40i.js";import{f as L}from"./formatters-B-4HXWs2.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const A={class:"page-container"},G={class:"log-list-container"},O=w({__name:"Check",setup(P){const k=T(),c=E(),i=p(""),g=p(null),u=p([]);M(()=>{d()});const d=()=>{$(()=>{g.value?.focus()})},_=t=>{u.value.unshift({...t,timestamp:L(new Date().toISOString())}),u.value.length>50&&u.value.pop()},v=async()=>{if(!i.value||c.loading)return;const t=i.value.trim();i.value="";try{await c.fetchItems({shortId:t});const e=c.items.find(l=>l.shortId===t);if(!e){const l=`物品 ${t} 未找到。`;h.error(l,2),_({shortId:t,message:l,status:"error"}),d();return}await c.updateItemStatus(e.id,"check");const a=`物品 ${e.itemDefinition?.name||t} 已盘点。`;h.success(a,2),_({shortId:t,message:a,status:"success"})}catch(e){const a=`盘点 ${t} 失败: ${e.message||"未知错误"}`;h.error(a,3),_({shortId:t,message:a,status:"error"})}finally{d()}};return(t,e)=>{const a=o("a-page-header"),l=o("a-input"),S=o("a-form-item"),x=o("a-form"),y=o("a-divider"),C=o("a-list-item-meta"),D=o("a-list-item"),b=o("a-list");return z(),B("div",null,[s(a,{title:"连续盘点",onBack:e[0]||(e[0]=n=>I(k).back())}),m("div",A,[s(x,{onSubmit:V(v,["prevent"])},{default:r(()=>[s(S,{label:"扫描或输入Short ID"},{default:r(()=>[s(l,{ref_key:"shortIdInputRef",ref:g,value:i.value,"onUpdate:value":e[1]||(e[1]=n=>i.value=n),placeholder:"请扫描或输入ID后按回车",onPressEnter:v,disabled:I(c).loading,"allow-clear":""},null,8,["value","disabled"])]),_:1})]),_:1}),s(y,null,{default:r(()=>e[2]||(e[2]=[N("最近盘点日志",-1)])),_:1,__:[2]}),m("div",G,[s(b,{"data-source":u.value,"item-layout":"horizontal",locale:{emptyText:"暂无盘点记录"}},{renderItem:r(({item:n})=>[s(D,null,{default:r(()=>[s(C,null,{title:r(()=>[m("span",{class:R(n.status==="success"?"log-success":"log-error")},f(n.message),3)]),description:r(()=>[m("span",null,"ID: "+f(n.shortId)+" | 时间: "+f(n.timestamp),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["data-source"])])])])}}}),H=q(O,[["__scopeId","data-v-e47d0a5e"]]);export{H as default};
