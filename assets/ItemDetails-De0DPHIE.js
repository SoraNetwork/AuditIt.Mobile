import{d as F,r as h,j,B as S,H as q,o as E,A as G,b as d,p as b,e as y,m as p,h as t,q as u,i as M,f as a,g as n,D as J,n as l,G as r,l as i}from"./index-D-N10Xfp.js";import{u as K}from"./itemStore-DFafVmDx.js";import{u as Q}from"./auditLogStore-cHOm0DJr.js";import{f as k}from"./formatters-C2zBs8_Z.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"page-wrapper"},Y={key:1,class:"details-section"},Z={key:0,class:"photo-container"},ee={key:0,class:"loading-container"},te={class:"list-item-wrapper"},ae=F({__name:"ItemDetails",setup(se){const C=j(),x=M(),D=K(),m=Q(),_=h(!0),f=C.params.id,v=h(null),I=h("300px"),e=S(()=>D.items.find(s=>s.id===f)),w=S(()=>e.value?.photoUrl?`${(q.defaults.baseURL||"").replace(/\/api$/,"")}${e.value.photoUrl}`:null),L=()=>{if(v.value){const s=v.value.offsetHeight,o=60;I.value=`calc(100vh - ${s}px - ${o}px)`}};E(async()=>{_.value=!0,m.logs=[];try{const s=e.value?Promise.resolve():D.fetchItems({id:f}),o=m.fetchLogs({itemId:f});await Promise.all([s,o])}catch(s){console.error("Failed to load item details:",s)}finally{_.value=!1,await G(),L()}});const U=s=>{switch(s){case"InStock":return"success";case"LoanedOut":return"warning";case"Disposed":return"error";default:return"default"}},B=s=>{switch(s){case"InStock":return"在库";case"LoanedOut":return"已借出";case"Disposed":return"已处置";default:return"未知"}};return(s,o)=>{const H=n("a-button"),N=n("a-page-header"),R=n("a-image"),c=n("a-descriptions-item"),$=n("a-badge"),P=n("a-descriptions"),T=n("a-spin"),V=n("a-list-item-meta"),O=n("a-card"),z=n("a-list"),A=n("a-empty");return i(),d("div",X,[b("div",{class:"fixed-content",ref_key:"fixedContentRef",ref:v},[e.value?(i(),y(N,{key:0,title:e.value.itemDefinition?.name,onBack:o[1]||(o[1]=()=>u(x).back())},{extra:t(()=>[a(H,{onClick:o[0]||(o[0]=()=>u(x).push({name:"item-edit",params:{id:e.value?.id}}))},{default:t(()=>o[2]||(o[2]=[l("编辑",-1)])),_:1,__:[2]})]),_:1},8,["title"])):p("",!0),!_.value&&e.value?(i(),d("div",Y,[w.value?(i(),d("div",Z,[a(R,{width:"100%",src:w.value,alt:"物品图片"},null,8,["src"])])):p("",!0),a(P,{bordered:"",column:1,style:{"margin-top":"16px"}},{default:t(()=>[a(c,{label:"短ID"},{default:t(()=>[l(r(e.value.shortId),1)]),_:1}),a(c,{label:"状态"},{default:t(()=>[a($,{status:U(e.value.status),text:B(e.value.status)},null,8,["status","text"])]),_:1}),a(c,{label:"仓库"},{default:t(()=>[l(r(e.value.warehouse?.name),1)]),_:1}),e.value.status==="LoanedOut"||e.value.status==="Disposed"?(i(),y(c,{key:0,label:"当前去向"},{default:t(()=>[l(r(e.value.currentDestination||"无"),1)]),_:1})):p("",!0),a(c,{label:"备注"},{default:t(()=>[l(r(e.value.remarks||"无"),1)]),_:1}),a(c,{label:"入库日期"},{default:t(()=>[l(r(u(k)(e.value.entryDate)),1)]),_:1}),a(c,{label:"最后更新"},{default:t(()=>[l(r(u(k)(e.value.lastUpdated)),1)]),_:1})]),_:1})])):p("",!0)],512),_.value?(i(),d("div",ee,[a(T,{size:"large"})])):e.value?(i(),d("div",{key:1,class:"scrollable-content",style:J({height:I.value})},[o[3]||(o[3]=b("h3",{class:"log-title"},"操作历史",-1)),a(z,{loading:u(m).loading,"data-source":u(m).logs,split:!1},{renderItem:t(({item:g})=>[b("div",te,[a(O,null,{default:t(()=>[a(V,null,{title:t(()=>[l(r(g.action)+" - by "+r(g.user),1)]),description:t(()=>[l(r(u(k)(g.timestamp)),1)]),_:2},1024)]),_:2},1024)])]),_:1},8,["loading","data-source"])],4)):(i(),y(A,{key:2}))])}}}),ce=W(ae,[["__scopeId","data-v-6f79c91f"]]);export{ce as default};
