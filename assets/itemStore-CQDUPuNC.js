import{Q as i,H as a}from"./index-DYVI02XC.js";import{v as o}from"./v4-BKrj-4V8.js";const d=t=>t.substring(0,8).toUpperCase(),p=i("item",{state:()=>({items:[],preInboundItems:[],loading:!1,error:null}),actions:{async fetchItems(t={}){this.loading=!0,this.error=null;try{const s=new URLSearchParams;t.warehouseId&&s.append("warehouseId",t.warehouseId.toString()),t.status&&s.append("status",t.status),t.id&&s.append("id",t.id),t.shortId&&s.append("shortId",t.shortId);const e=await a.get(`/items?${s.toString()}`);this.items=e.data}catch(s){this.error="获取库存物品失败: "+(s.response?.data?.message||s.message)}finally{this.loading=!1}},preInbound(t,s){this.preInboundItems=[];for(let e=0;e<s;e++){const n=o();this.preInboundItems.push({id:n,shortId:d(n),itemDefinitionId:t})}},async confirmInbound(t){if(this.preInboundItems.length!==0){this.loading=!0,this.error=null;try{const s=this.preInboundItems.map(r=>a.post("/items/inbound",{itemDefinitionId:r.itemDefinitionId,warehouseId:t})),n=(await Promise.all(s)).map(r=>r.data);this.items.unshift(...n),this.preInboundItems=[]}catch(s){throw this.error="确认入库失败: "+(s.response?.data?.message||s.message),s}finally{this.loading=!1}}},async updateItemStatus(t,s){this.loading=!0,this.error=null;try{const e=await a.put(`/items/${t}/${s}`),n=this.items.findIndex(r=>r.id===t);n!==-1&&(this.items[n]=e.data)}catch(e){throw this.error=`物品操作 '${s}' 失败: `+(e.response?.data?.message||e.message),e}finally{this.loading=!1}}}});export{p as u};
