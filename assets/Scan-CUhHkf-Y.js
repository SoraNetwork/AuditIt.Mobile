import{d as K,r as p,x as F,o as G,M as P,a as _,e as t,m as w,f as s,k as r,w as a,J as W,K as X,p as B,l,E as N,b as $,i as E,j as u}from"./index-CUAOOoWf.js";import{a as Y}from"./html5-qrcode-scanner-DEX2K3uf.js";import{u as Z}from"./itemStore-BH4vbJI0.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"page-container"},ae={key:0},ne={key:0,class:"controls"},oe={key:1},se={key:2,class:"feedback-container"},le={key:3,class:"feedback-container"},ue={key:4,class:"item-details"},re={class:"action-buttons"},ie=K({__name:"Scan",setup(de){const i=Z();let f=null;const v=p("scan"),I=p(""),k=p(!1),n=p(null),m=p(null),x=p(null),b=()=>{if(!x.value){setTimeout(b,100);return}f||(f=new Y(x.value.id)),D();const o={fps:10,qrbox:{width:250,height:250}},e=async S=>{g(),await C(S)};f.start({facingMode:"environment"},o,e,void 0).then(()=>{k.value=!0}).catch(S=>{m.value="无法启动摄像头。请检查权限。"})},g=()=>{f&&k.value&&f.stop().then(()=>{k.value=!1})},L=o=>{o&&C(o)},C=async o=>{await i.fetchItems({shortId:o}),i.items.length>0?n.value=i.items[0]:m.value=`未找到ID为 "${o}" 的物品。`},y=async o=>{if(n.value)try{await i.updateItemStatus(n.value.id,o),E.success(`操作成功: ${o}`),await C(n.value.shortId)}catch{E.error("操作失败")}},D=()=>{n.value=null,m.value=null,I.value="",i.items=[]};F(v,o=>{o==="scan"?b():g()}),G(()=>{v.value==="scan"&&b()}),P(()=>{g()});const O=o=>{switch(o){case"InStock":return"success";case"LoanedOut":return"warning";case"Disposed":return"error";default:return"default"}},T=o=>{switch(o){case"InStock":return"在库";case"LoanedOut":return"已借出";case"Disposed":return"已处置";default:return"未知"}};return(o,e)=>{const S=s("a-page-header"),M=s("a-radio-button"),U=s("a-radio-group"),d=s("a-button"),V=s("a-input-search"),z=s("a-form-item"),Q=s("a-form"),R=s("a-spin"),j=s("a-alert"),h=s("a-descriptions-item"),q=s("a-badge"),A=s("a-descriptions"),H=s("a-divider"),J=s("a-card");return u(),_("div",null,[t(S,{title:"物品操作"}),w("div",te,[t(U,{value:v.value,"onUpdate:value":e[0]||(e[0]=c=>v.value=c),"button-style":"solid",style:{"margin-bottom":"16px",width:"100%"}},{default:a(()=>[t(M,{value:"scan",style:{width:"50%","text-align":"center"}},{default:a(()=>e[6]||(e[6]=[l("扫码输入",-1)])),_:1,__:[6]}),t(M,{value:"manual",style:{width:"50%","text-align":"center"}},{default:a(()=>e[7]||(e[7]=[l("手动输入",-1)])),_:1,__:[7]})]),_:1},8,["value"]),v.value==="scan"?(u(),_("div",ae,[W(w("div",{id:"reader",ref_key:"readerRef",ref:x},null,512),[[X,!n.value&&!m.value]]),n.value?r("",!0):(u(),_("div",ne,[t(d,{onClick:b,disabled:k.value},{default:a(()=>e[8]||(e[8]=[l("开始扫描",-1)])),_:1,__:[8]},8,["disabled"]),t(d,{onClick:g,disabled:!k.value,danger:""},{default:a(()=>e[9]||(e[9]=[l("停止扫描",-1)])),_:1,__:[9]},8,["disabled"])]))])):r("",!0),v.value==="manual"&&!n.value?(u(),_("div",oe,[t(Q,null,{default:a(()=>[t(z,{label:"通过物品ID查找"},{default:a(()=>[t(V,{value:I.value,"onUpdate:value":e[1]||(e[1]=c=>I.value=c),placeholder:"输入物品短ID","enter-button":"查找",onSearch:L},null,8,["value"])]),_:1})]),_:1})])):r("",!0),B(i).loading?(u(),_("div",se,[t(R,{size:"large",tip:"正在获取物品信息..."})])):r("",!0),m.value&&!B(i).loading?(u(),_("div",le,[t(j,{message:"错误",description:m.value,type:"error","show-icon":""},{action:a(()=>[t(d,{size:"small",type:"primary",onClick:D},{default:a(()=>e[10]||(e[10]=[l("重试",-1)])),_:1,__:[10]})]),_:1},8,["description"])])):r("",!0),n.value&&!B(i).loading?(u(),_("div",ue,[t(J,{title:n.value.itemDefinition?.name||"未知物品"},{default:a(()=>[t(A,{bordered:"",column:1},{default:a(()=>[t(h,{label:"短ID"},{default:a(()=>[l(N(n.value.shortId),1)]),_:1}),t(h,{label:"状态"},{default:a(()=>[t(q,{status:O(n.value.status),text:T(n.value.status)},null,8,["status","text"])]),_:1}),t(h,{label:"仓库"},{default:a(()=>[l(N(n.value.warehouse?.name),1)]),_:1})]),_:1}),w("div",re,[e[16]||(e[16]=w("h3",null,"待操作列表",-1)),n.value.status==="InStock"?(u(),$(d,{key:0,onClick:e[2]||(e[2]=c=>y("outbound")),block:""},{default:a(()=>e[11]||(e[11]=[l("借出",-1)])),_:1,__:[11]})):r("",!0),n.value.status==="LoanedOut"?(u(),$(d,{key:1,onClick:e[3]||(e[3]=c=>y("return")),block:""},{default:a(()=>e[12]||(e[12]=[l("归还",-1)])),_:1,__:[12]})):r("",!0),t(d,{onClick:e[4]||(e[4]=c=>y("check")),block:""},{default:a(()=>e[13]||(e[13]=[l("盘点",-1)])),_:1,__:[13]}),n.value.status!=="Disposed"?(u(),$(d,{key:2,onClick:e[5]||(e[5]=c=>y("dispose")),danger:"",block:""},{default:a(()=>e[14]||(e[14]=[l("处置",-1)])),_:1,__:[14]})):r("",!0),t(H),t(d,{onClick:D,block:""},{default:a(()=>e[15]||(e[15]=[l("查找下一个",-1)])),_:1,__:[15]})])]),_:1},8,["title"])])):r("",!0)])])}}}),pe=ee(ie,[["__scopeId","data-v-e3d6ca65"]]);export{pe as default};
