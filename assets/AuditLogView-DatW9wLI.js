import{f as t,I as j,d as D,r as x,C as F,B as P,W as z,o as T,A as U,b as C,p as d,q as p,i as E,g as r,h as o,D as q,n as c,m as G,G as _,l as L}from"./index-CnWZh0I3.js";import{u as W}from"./auditLogStore-DnL0AFM4.js";import{f as J}from"./formatters--pc9J3Oa.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";var X={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"};function R(u){for(var s=1;s<arguments.length;s++){var l=arguments[s]!=null?Object(arguments[s]):{},i=Object.keys(l);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(l).filter(function(a){return Object.getOwnPropertyDescriptor(l,a).enumerable}))),i.forEach(function(a){Y(u,a,l[a])})}return u}function Y(u,s,l){return s in u?Object.defineProperty(u,s,{value:l,enumerable:!0,configurable:!0,writable:!0}):u[s]=l,u}var O=function(s,l){var i=R({},s,l.attrs);return t(j,R({},i,{icon:X}),null)};O.displayName="FilterOutlined";O.inheritAttrs=!1;const Z={class:"page-wrapper"},K={class:"filter-controls"},ee={class:"list-item-wrapper"},te={class:"log-meta"},ae={class:"log-meta"},oe={key:0,style:{"text-align":"center","margin-top":"16px"}},ne=D({__name:"AuditLogView",setup(u){const s=E(),l=W(),i=x(!1),a=F({dateRange:null,action:void 0,user:""}),g=x(null),h=x("400px"),V=()=>{if(g.value){const f=g.value.offsetHeight,e=60;h.value=`calc(100vh - ${f}px - ${e}px)`}},k=P(()=>l.logs.filter(f=>{const e=z(f.timestamp),b=!a.dateRange||e.isAfter(a.dateRange[0].startOf("day"))&&e.isBefore(a.dateRange[1].endOf("day")),m=!a.action||f.action===a.action,w=!a.user||f.user.toLowerCase().includes(a.user.toLowerCase());return b&&m&&w}));return T(async()=>{await l.fetchLogs(),await U(),V()}),(f,e)=>{const b=r("a-page-header"),m=r("a-button"),w=r("router-link"),S=r("a-card"),B=r("a-empty"),H=r("a-list"),M=r("a-range-picker"),y=r("a-form-item"),v=r("a-select-option"),N=r("a-select"),$=r("a-input"),A=r("a-form"),I=r("a-drawer");return L(),C("div",Z,[d("div",{class:"fixed-content",ref_key:"fixedContentRef",ref:g},[t(b,{title:"审计日志",onBack:e[0]||(e[0]=n=>p(s).back())}),d("div",K,[t(m,{block:"",onClick:e[1]||(e[1]=n=>i.value=!0)},{icon:o(()=>[t(p(O))]),default:o(()=>[e[7]||(e[7]=c(" 筛选日志 ",-1))]),_:1,__:[7]})])],512),d("div",{class:"scrollable-content",style:q({height:h.value})},[t(H,{"data-source":k.value,loading:p(l).loading,split:!1},{renderItem:o(({item:n})=>[d("div",ee,[t(S,null,{default:o(()=>[d("p",null,[d("strong",null,_(n.action),1),e[8]||(e[8]=c(" - ",-1)),t(w,{to:{name:"item-details",params:{id:n.itemId}}},{default:o(()=>[c(_(n.itemShortId),1)]),_:2},1032,["to"])]),d("p",te,_(p(J)(n.timestamp)),1),d("p",ae,"操作人: "+_(n.user)+" | 仓库: "+_(n.warehouseName),1)]),_:2},1024)])]),loadMore:o(()=>[!p(l).loading&&k.value.length===0?(L(),C("div",oe,[t(B,{description:"没有找到符合条件的日志"})])):G("",!0)]),_:1},8,["data-source","loading"])],4),t(I,{title:"筛选日志",width:"90%",open:i.value,onClose:e[6]||(e[6]=n=>i.value=!1)},{footer:o(()=>[t(m,{onClick:e[5]||(e[5]=n=>i.value=!1)},{default:o(()=>e[13]||(e[13]=[c("关闭",-1)])),_:1,__:[13]})]),default:o(()=>[t(A,{layout:"vertical",model:a},{default:o(()=>[t(y,{label:"日期范围"},{default:o(()=>[t(M,{value:a.dateRange,"onUpdate:value":e[2]||(e[2]=n=>a.dateRange=n),style:{width:"100%"}},null,8,["value"])]),_:1}),t(y,{label:"操作类型"},{default:o(()=>[t(N,{value:a.action,"onUpdate:value":e[3]||(e[3]=n=>a.action=n),placeholder:"所有类型","allow-clear":""},{default:o(()=>[t(v,{value:"入库"},{default:o(()=>e[9]||(e[9]=[c("入库",-1)])),_:1,__:[9]}),t(v,{value:"借出"},{default:o(()=>e[10]||(e[10]=[c("借出",-1)])),_:1,__:[10]}),t(v,{value:"处置"},{default:o(()=>e[11]||(e[11]=[c("处置",-1)])),_:1,__:[11]}),t(v,{value:"归还"},{default:o(()=>e[12]||(e[12]=[c("归还",-1)])),_:1,__:[12]})]),_:1},8,["value"])]),_:1}),t(y,{label:"操作人"},{default:o(()=>[t($,{value:a.user,"onUpdate:value":e[4]||(e[4]=n=>a.user=n),placeholder:"输入用户名","allow-clear":""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])])}}}),ue=Q(ne,[["__scopeId","data-v-60429fcd"]]);export{ue as default};
